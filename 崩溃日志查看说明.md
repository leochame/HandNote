# 崩溃日志查看说明

## 问题：应用自动退出，找不到报错信息

我已经增强了应用的崩溃日志记录功能，现在所有崩溃都会被记录到文件中。

## 查看崩溃日志的方法

### 方法1：在应用内查看（推荐）

1. 打开应用
2. 点击底部导航栏的"设置"（最右边的图标）
3. 点击"查看日志"卡片
4. 在日志查看器中：
   - **应用日志** 标签页：查看所有应用日志（包括崩溃前的日志）
   - **崩溃报告** 标签页：查看详细的崩溃报告（如果有崩溃发生）

### 方法2：使用 ADB 命令（需要连接设备）

```bash
# 查看崩溃报告
adb shell run-as com.handnote.app cat files/crash_report.txt

# 查看最新的日志文件
adb shell run-as com.handnote.app cat files/logs/app_$(date +%Y-%m-%d).log

# 列出所有日志文件
adb shell run-as com.handnote.app ls -la files/logs/
```

### 方法3：导出日志文件

如果应用能够启动，可以在日志查看器中复制日志内容。

## 崩溃日志位置

- **崩溃报告**：`/data/data/com.handnote.app/files/crash_report.txt`
- **应用日志**：`/data/data/com.handnote.app/files/logs/app_YYYY-MM-DD.log`

## 增强的日志功能

1. **详细的启动日志**：MainActivity 的每个初始化步骤都会记录日志
2. **崩溃报告**：每次崩溃都会生成详细的崩溃报告，包括：
   - 崩溃时间
   - 异常类型和消息
   - 完整的堆栈跟踪
3. **全局异常捕获**：所有未捕获的异常都会被记录

## 调试建议

如果应用仍然自动退出：

1. **查看崩溃报告**：在应用内打开日志查看器，查看"崩溃报告"标签页
2. **查看启动日志**：查看"应用日志"标签页，找到最后几条日志，看看应用在哪个步骤崩溃了
3. **常见崩溃原因**：
   - 数据库初始化失败
   - Repository 初始化失败
   - UI 组件初始化失败
   - 权限问题

## 日志格式说明

日志文件格式：
```
[2024-01-15 10:30:45.123] [DEBUG] [MainActivity] MainActivity.onCreate started
[2024-01-15 10:30:45.456] [DEBUG] [MainActivity] Starting database initialization...
[2024-01-15 10:30:45.789] [ERROR] [MainActivity] CRASH: Uncaught exception in thread main
java.lang.RuntimeException: ...
    at ...
```

崩溃报告格式：
```
========================================
CRASH REPORT
========================================
Timestamp: 2024-01-15 10:30:45.789
Exception: java.lang.RuntimeException
Message: ...

Stack Trace:
...
========================================
```

## 下一步

如果应用仍然崩溃，请：
1. 打开应用内的日志查看器
2. 复制崩溃报告的内容
3. 将崩溃报告发送给开发者进行调试

