# 日志系统使用说明

## 概述

应用现在支持将日志同时输出到 Logcat 和文件。所有日志文件保存在应用的内部存储目录中。

## 日志文件位置

日志文件保存在：`/data/data/com.handnote.app/files/logs/`

### 查看日志文件的方法

#### 方法1：使用 ADB 命令

```bash
# 查看所有日志文件
adb shell run-as com.handnote.app ls -la files/logs/

# 查看最新的日志文件内容
adb shell run-as com.handnote.app cat files/logs/app_$(date +%Y-%m-%d).log

# 导出日志文件到本地
adb shell run-as com.handnote.app cat files/logs/app_$(date +%Y-%m-%d).log > log.txt
```

#### 方法2：在代码中访问

```kotlin
import com.handnote.app.util.FileLogger

// 获取所有日志文件
val logFiles = FileLogger.getLogFiles(context)

// 获取最新的日志文件
val latestLog = FileLogger.getLatestLogFile(context)

// 导出日志到外部存储（需要权限）
val targetFile = File(context.getExternalFilesDir(null), "exported_log.txt")
FileLogger.exportLogToExternalStorage(context, targetFile)

// 清除所有日志
FileLogger.clearAllLogs(context)
```

## 日志格式

日志文件格式如下：

```
[2024-01-15 10:30:45.123] [DEBUG] [MainScreen] MainScreen composable called
[2024-01-15 10:30:45.456] [INFO] [CalendarScreen] CalendarScreen initialized
[2024-01-15 10:30:45.789] [ERROR] [MainActivity] Failed to initialize app
java.lang.Exception: ...
    at ...
```

## 日志级别

- **DEBUG**: 调试信息
- **INFO**: 一般信息
- **WARN**: 警告信息
- **ERROR**: 错误信息（包含异常堆栈）

## 日志管理

### 自动清理

- 单个日志文件最大 5MB，超过后会自动创建新文件
- 最多保留 10 个日志文件，旧的会被自动删除
- 日志文件按日期命名：`app_YYYY-MM-DD.log`

### 手动清理

在代码中调用：
```kotlin
FileLogger.clearAllLogs(context)
```

## 使用示例

### 在代码中使用 FileLogger

```kotlin
import com.handnote.app.util.FileLogger

// Debug 日志
FileLogger.d("MyTag", "This is a debug message")

// Info 日志
FileLogger.i("MyTag", "This is an info message")

// Warning 日志
FileLogger.w("MyTag", "This is a warning message")

// Error 日志（带异常）
FileLogger.e("MyTag", "This is an error message", exception)
```

## 注意事项

1. 日志文件保存在应用内部存储，卸载应用时会自动删除
2. 日志文件会自动清理，无需手动管理
3. 生产环境建议关闭 DEBUG 级别的日志输出
4. 导出日志到外部存储需要相应的权限

